services:
  - type: web
    name: passive-captcha
    env: python
    buildCommand: |
      echo "üèóÔ∏è Building Passive CAPTCHA for Render..."
      echo "üì¶ Installing Node.js dependencies..."
      cd frontend && npm install --no-audit --no-fund
      echo "üî® Building frontend..."
      npm run build
      echo "üìÇ Copying frontend to backend static folder..."
      cd ..
      mkdir -p backend/static
      cp -r frontend/dist/* backend/static/
      echo "üêç Installing Python dependencies..."
      pip install -r backend/requirements-render.txt
      echo "‚úÖ Build completed successfully!"
    startCommand: "cd backend && python main.py --gunicorn"
    plan: free
    runtime: python3.11
    envVars:
      - key: FLASK_ENV
        value: production
      - key: ADMIN_SECRET
        sync: false
      - key: HOST
        value: 0.0.0.0
      - key: PORT
        fromGroup: 5003
      - key: RENDER_EXTERNAL_URL
        value: https://passive-captcha.onrender.com
      - key: ALLOWED_ORIGINS
        value: https://passive-captcha.onrender.com,http://localhost:3000,*
      - key: API_BASE_URL
        value: https://passive-captcha.onrender.com
      - key: WEBSOCKET_URL
        value: wss://passive-captcha.onrender.com
      - key: DATABASE_URL
        value: sqlite:///passive_captcha_production.db
      - key: NODE_VERSION
        value: "18"
    healthCheckPath: /health