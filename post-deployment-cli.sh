#!/bin/bash

echo "üö® RENDER DEPLOYMENT TROUBLESHOOTING"
echo "===================================="
echo ""
echo "üîç ISSUE DETECTED:"
echo "Render is trying to run: 'gunicorn your_application.wsgi'"
echo "Should be running: 'gunicorn app:app'"
echo ""
echo "üõ†Ô∏è SOLUTIONS:"
echo ""
echo "Option 1: Delete and Redeploy (Recommended)"
echo "1. Go to your Render dashboard"
echo "2. Delete the current backend service"
echo "3. Create new service using Blueprint:"
echo "   - Click 'New' ‚Üí 'Blueprint'"
echo "   - Connect repo: https://github.com/Riishi-01/Passive-captcha.git"
echo "   - Render will auto-detect render.yaml"
echo ""
echo "Option 2: Manual Fix"
echo "1. Go to your service settings on Render"
echo "2. Update Start Command to: gunicorn app:app --bind 0.0.0.0:\$PORT --workers 2 --timeout 120"
echo "3. Set Root Directory to: backend"
echo "4. Set Build Command to: pip install --upgrade pip && pip install -r requirements-deploy.txt"
echo ""
echo "Option 3: Environment Variables Check"
echo "Ensure these are set in Render dashboard:"
echo "- FLASK_ENV=production"
echo "- MODEL_PATH=models/passive_captcha_rf.pkl"
echo "- DATABASE_URL=sqlite:///passive_captcha.db"
echo "- CONFIDENCE_THRESHOLD=0.6"
echo "- SECRET_KEY=<auto-generated>"
echo "- ADMIN_SECRET=<auto-generated>"
echo ""
echo "‚úÖ VERIFICATION:"
echo "After redeployment, check:"
echo "- https://your-app.onrender.com/health"
echo "- Should return: {'status': 'healthy', 'model_loaded': true}"
echo ""
echo "üìã Our render.yaml is correctly configured!"
echo "The issue is likely from manual service creation instead of Blueprint deployment." 