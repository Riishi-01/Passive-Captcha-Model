!function(e,t){"use strict";const n={API_URL:"https://passive-captcha-api.railway.app",COLLECTION_DURATION:15e3,MIN_EVENTS_THRESHOLD:5,CONFIDENCE_THRESHOLD:.7};let a={sessionId:i(),mouseMovements:[],keystrokes:[],scrollEvents:[],sessionStart:Date.now(),fingerprint:{}},o=!1,s=!1,r=null,c={};const l={init:function(e={}){if(o)return void console.warn("PassiveCaptcha already initialized");Object.assign(n,e),c={onVerified:e.onVerified||function(){},onError:e.onError||function(){},onDataCollected:e.onDataCollected||function(){}},d(),e.element&&u(e.element),m(),o=!0,console.log("PassiveCaptcha initialized")},verify:async function(){if(!o)return void console.error("PassiveCaptcha not initialized");try{return await g()}catch(e){return console.error("Verification failed:",e),{isHuman:!1,confidence:0,error:e.message}}},getSessionData:()=>a,reset:function(){a={sessionId:i(),mouseMovements:[],keystrokes:[],scrollEvents:[],sessionStart:Date.now(),fingerprint:{}},s=!1,clearTimeout(r),d()},setConfig:function(e){Object.assign(n,e)}};function i(){return"session_"+Date.now()+"_"+Math.random().toString(36).substr(2,9)}function d(){s||(s=!0,t.addEventListener("mousemove",f),t.addEventListener("keydown",p),t.addEventListener("scroll",v),r=setTimeout((()=>{s=!1,t.removeEventListener("mousemove",f),t.removeEventListener("keydown",p),t.removeEventListener("scroll",v),c.onDataCollected(a)}),n.COLLECTION_DURATION))}function u(n){const a=t.querySelector(n);a&&a.addEventListener("click",(async()=>{const e=await l.verify();c.onVerified(e)}))}function f(e){s&&a.mouseMovements.push({x:e.clientX,y:e.clientY,timestamp:Date.now()})}function p(e){s&&a.keystrokes.push({key:e.key,timestamp:Date.now()})}function v(e){s&&a.scrollEvents.push({y:e.target.scrollTop||e.pageY,timestamp:Date.now()})}async function m(){const e=t.createElement("canvas"),n=e.getContext("2d");n.textBaseline="top",n.font="14px Arial",n.fillText("Canvas fingerprint test",2,2);const o=e.toDataURL(),s=navigator.hardwareConcurrency||4,r=e.getContext("webgl")||e.getContext("experimental-webgl"),c=r?r.getParameter(r.VENDOR):"unknown";a.fingerprint={userAgent:navigator.userAgent,screenWidth:screen.width,screenHeight:screen.height,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,language:navigator.language,platform:navigator.platform,cookieEnabled:navigator.cookieEnabled,hardwareConcurrency:s,canvasFingerprint:o.substr(-50),webglVendor:c,plugins:Array.from(navigator.plugins).map((e=>e.name))}}async function g(){try{const e=Date.now(),t=a.mouseMovements.length,o=a.keystrokes.length;if(t<n.MIN_EVENTS_THRESHOLD&&0===o)return{isHuman:!1,confidence:.1,reason:"Insufficient interaction data"};const s={sessionId:a.sessionId,mouseMovements:a.mouseMovements,keystrokes:a.keystrokes,scrollEvents:a.scrollEvents,fingerprint:a.fingerprint,sessionDuration:e-a.sessionStart,origin:location.hostname},r=await fetch(`${n.API_URL}/api/verify`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!r.ok)throw new Error(`API request failed: ${r.status}`);const c=await r.json();if(c.error)throw new Error(c.error.message);return c}catch(e){return console.error("Verification request failed:",e),{isHuman:!1,confidence:0,error:e.message}}}e.PassiveCaptcha=l,t.addEventListener("DOMContentLoaded",(function(){const e=t.querySelector("[data-passive-captcha]");if(e){const t={element:e.getAttribute("data-target")||e,onVerified:function(e){console.log("PassiveCaptcha verification result:",e)}};l.init(t)}}))}(window,document); 