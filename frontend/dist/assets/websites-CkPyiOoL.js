import{e,D as t,q as s,H as a,r as n,I as i}from"./vendor-BIO1jeMb.js";import{a as r}from"./utils-Bp8ce8Co.js";function o(a,n){return t(),e("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3"})])}function c(a,n){return t(),e("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m19.5 8.25-7.5 7.5-7.5-7.5"})])}function l(a,n){return t(),e("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 21a9.004 9.004 0 0 0 8.716-6.747M12 21a9.004 9.004 0 0 1-8.716-6.747M12 21c2.485 0 4.5-4.03 4.5-9S14.485 3 12 3m0 18c-2.485 0-4.5-4.03-4.5-9S9.515 3 12 3m0 0a8.997 8.997 0 0 1 7.843 4.582M12 3a8.997 8.997 0 0 0-7.843 4.582m15.686 0A11.953 11.953 0 0 1 12 10.5c-2.998 0-5.74-1.1-7.843-2.918m15.686 0A8.959 8.959 0 0 1 21 12c0 .778-.099 1.533-.284 2.253m0 0A17.919 17.919 0 0 1 12 16.5c-3.162 0-6.133-.815-8.716-2.247m0 0A9.015 9.015 0 0 1 3 12c0-1.605.42-3.113 1.157-4.418"})])}function u(a,n){return t(),e("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 4.5v15m7.5-7.5h-15"})])}const h=new class{axiosInstance;baseURL;constructor(){this.baseURL="http://localhost:5003",this.axiosInstance=r.create({baseURL:this.baseURL,timeout:3e4,headers:{"Content-Type":"application/json"}}),this.axiosInstance.interceptors.request.use(e=>{const t=localStorage.getItem("admin_token");return t&&(e.headers.Authorization=`Bearer ${t}`),e}),this.axiosInstance.interceptors.response.use(e=>e,e=>(401===e.response?.status&&(localStorage.removeItem("admin_token"),window.location.href="/login"),Promise.reject(e)))}async handleRequest(e){try{return(await e).data}catch(t){if(console.error("API Error:",t),t.response?.data)throw{code:t.response.data.error?.code||"API_ERROR",message:t.response.data.error?.message||"An error occurred",status:t.response.status};throw{code:"NETWORK_ERROR",message:"Network connection failed",status:0}}}async login(e){return this.handleRequest(this.axiosInstance.post("/admin/login",{password:e}))}async verifyToken(){return this.handleRequest(this.axiosInstance.get("/admin/verify-token"))}async getDashboardStats(e="24h"){return this.handleRequest(this.axiosInstance.get(`/admin/analytics/stats?timeRange=${e}`))}async getChartData(e="24h"){return this.handleRequest(this.axiosInstance.get(`/admin/analytics/charts?timeRange=${e}`))}async getDetectionData(e="24h"){return this.handleRequest(this.axiosInstance.get(`/admin/analytics/detection?timeRange=${e}`))}async getSystemHealth(){return this.handleRequest(this.axiosInstance.get("/admin/health"))}async getRecentAlerts(){return this.handleRequest(this.axiosInstance.get("/admin/alerts/recent"))}async getTimelineLogs(e="all",t=0,s=50){return this.handleRequest(this.axiosInstance.get(`/admin/logs/timeline?filter=${e}&offset=${t}&limit=${s}`))}async getWebsites(e=!0){return this.handleRequest(this.axiosInstance.get(`/admin/websites?include_analytics=${e}`))}async createWebsite(e){return this.handleRequest(this.axiosInstance.post("/admin/websites",e))}async updateWebsite(e,t){return this.handleRequest(this.axiosInstance.put(`/admin/websites/${e}`,t))}async deleteWebsite(e){return this.handleRequest(this.axiosInstance.delete(`/admin/websites/${e}`))}async toggleWebsiteStatus(e){return this.handleRequest(this.axiosInstance.patch(`/admin/websites/${e}/status`))}async getMLMetrics(e="24h"){return this.handleRequest(this.axiosInstance.get(`/admin/ml/metrics?timeRange=${e}`))}async getModelInfo(){return this.handleRequest(this.axiosInstance.get("/admin/ml/info"))}async retrainModel(){return this.handleRequest(this.axiosInstance.post("/admin/ml/retrain"))}async generateScriptToken(e){return this.handleRequest(this.axiosInstance.post(`/admin/scripts/tokens/${e}`))}async getScriptTokenInfo(e){return this.handleRequest(this.axiosInstance.get(`/admin/scripts/tokens/${e}`))}async deleteScriptToken(e){return this.handleRequest(this.axiosInstance.delete(`/admin/scripts/tokens/${e}`))}async exportData(e,t,s){const a=new URLSearchParams({format:e,type:t,...s&&{timeRange:s}});return this.handleRequest(this.axiosInstance.get(`/admin/export?${a}`))}async getRealtimeStats(){return this.handleRequest(this.axiosInstance.get("/admin/realtime/stats"))}async getApiConfig(){return this.handleRequest(this.axiosInstance.get("/admin/config/api"))}async updateApiConfig(e){return this.handleRequest(this.axiosInstance.put("/admin/config/api",e))}},d=a("websites",()=>{const e=n([]),t=n([]),s=n(null),a=n({}),r=n(!1),o=n(null),c=async(e,t={})=>{const s=localStorage.getItem("admin_token");if(!s)throw new Error("No authentication token found");try{const a=await axios({url:`http://localhost:5003${e}`,headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json",...t.headers},...t});if(void 0!==a.data.success){if(!a.data.success)throw new Error(a.data.error?.message||"API request failed");return a.data.data||a.data}return a.data}catch(a){throw console.error("API request failed:",a),401===a.response?.status&&(localStorage.removeItem("admin_token"),window.location.href="/login"),a}},l=async(s=!0)=>{try{r.value=!0,o.value=null;const a=await h.getWebsites(s);a.success&&a.data&&(e.value=a.data.websites,t.value=a.data.websites.filter(e=>"active"===e.status))}catch(a){console.error("Failed to fetch websites:",a),o.value=a.message||"Failed to fetch websites",e.value=[],t.value=[]}finally{r.value=!1}},u=e=>{try{return e.startsWith("http")?new URL(e).pathname:e.startsWith("/")?e:"/"+e}catch{return"/"}},d=i(()=>e.value.length),m=i(()=>t.value.length),g=i(()=>e.value.reduce((e,t)=>e+t.totalVerifications,0)),w=i(()=>{if(0===e.value.length)return 0;const t=e.value.reduce((e,t)=>e+t.humanRate,0);return Math.round(t/e.value.length)});return{websites:e,activeWebsites:t,selectedWebsite:s,websiteStats:a,isLoading:r,error:o,fetchWebsites:l,fetchActiveWebsites:async()=>(await l(),t.value),fetchWebsiteStats:async(e,t="24h")=>{try{const s="24h"===t?24:"7d"===t?168:24,n=(await c(`/admin/logs?origin=${e}&hours=${s}&limit=1000`)).data.logs||[],i={hourlyVerifications:new Array(24).fill(0),humanVsBotRatio:{human:0,bot:0},topPages:[],averageResponseTime:100},r=new Map,o=new Map;n.forEach(e=>{const t=new Date(e.timestamp).getHours();r.set(t,(r.get(t)||0)+1),e.isHuman||e.is_human?i.humanVsBotRatio.human++:i.humanVsBotRatio.bot++;const s=u(e.origin||"/");o.set(s,(o.get(s)||0)+1)});for(let e=0;e<24;e++)i.hourlyVerifications[e]=r.get(e)||0;return i.topPages=Array.from(o.entries()).sort((e,t)=>t[1]-e[1]).slice(0,5).map(([e,t])=>({path:e,verifications:t})),a.value[e]=i,i}catch(s){throw console.error("Error fetching website stats:",s),s}},selectWebsite:e=>{s.value=e},addWebsite:async(s,a,n)=>{try{r.value=!0,o.value=null;const i=await h.createWebsite({name:s,url:a,description:n});if(i.success&&i.data)return e.value.unshift(i.data.website),"active"===i.data.website.status&&t.value.unshift(i.data.website),i.data.website}catch(i){throw console.error("Failed to add website:",i),o.value=i.message||"Failed to add website",i}finally{r.value=!1}},updateWebsite:async(t,s)=>{const a=e.value.findIndex(e=>e.id===t);if(-1!==a)return e.value[a]={...e.value[a],...s},e.value[a];throw new Error("Website not found")},deleteWebsite:async t=>{e.value=e.value.filter(e=>e.id!==t),delete a.value[t],s.value?.id===t&&(s.value=null)},totalWebsites:d,activeWebsiteCount:m,totalVerifications:g,avgHumanRate:w}});export{l as a,c as b,o as c,h as d,u as r,d as u};
