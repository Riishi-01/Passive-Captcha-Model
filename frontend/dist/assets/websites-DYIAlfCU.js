import{e,D as t,q as a,H as s,r,I as i}from"./vendor-BByfD4fc.js";import{b as o}from"./api-BEfkNQr2.js";function n(s,r){return t(),e("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m19.5 8.25-7.5 7.5-7.5-7.5"})])}const l=s("websites",()=>{const e=r([]),t=r([]),a=r(null),s=r({}),n=r(!1),l=r(null),u=async(e,t={})=>{const a=localStorage.getItem("admin_token");if(!a)throw new Error("No authentication token found");try{const s=await axios({url:`http://localhost:5002${e}`,headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json",...t.headers},...t});if(void 0!==s.data.success){if(!s.data.success)throw new Error(s.data.error?.message||"API request failed");return s.data.data||s.data}return s.data}catch(s){throw console.error("API request failed:",s),401===s.response?.status&&(localStorage.removeItem("admin_token"),window.location.href="/login"),s}},c=async(a=!0)=>{try{n.value=!0,l.value=null;const s=await o.getWebsites(a);s.success&&s.data&&(e.value=s.data.websites,t.value=s.data.websites.filter(e=>"active"===e.status))}catch(s){console.error("Failed to fetch websites:",s),l.value=s.message||"Failed to fetch websites",e.value=[],t.value=[]}finally{n.value=!1}},d=e=>{try{return e.startsWith("http")?new URL(e).pathname:e.startsWith("/")?e:"/"+e}catch{return"/"}},h=i(()=>e.value.length),v=i(()=>t.value.length),w=i(()=>e.value.reduce((e,t)=>e+t.totalVerifications,0)),f=i(()=>{if(0===e.value.length)return 0;const t=e.value.reduce((e,t)=>e+t.humanRate,0);return Math.round(t/e.value.length)});return{websites:e,activeWebsites:t,selectedWebsite:a,websiteStats:s,isLoading:n,error:l,fetchWebsites:c,fetchActiveWebsites:async()=>(await c(),t.value),fetchWebsiteStats:async(e,t="24h")=>{try{const a="24h"===t?24:"7d"===t?168:24,r=(await u(`/admin/logs?origin=${e}&hours=${a}&limit=1000`)).data.logs||[],i={hourlyVerifications:new Array(24).fill(0),humanVsBotRatio:{human:0,bot:0},topPages:[],averageResponseTime:100},o=new Map,n=new Map;r.forEach(e=>{const t=new Date(e.timestamp).getHours();o.set(t,(o.get(t)||0)+1),e.isHuman||e.is_human?i.humanVsBotRatio.human++:i.humanVsBotRatio.bot++;const a=d(e.origin||"/");n.set(a,(n.get(a)||0)+1)});for(let e=0;e<24;e++)i.hourlyVerifications[e]=o.get(e)||0;return i.topPages=Array.from(n.entries()).sort((e,t)=>t[1]-e[1]).slice(0,5).map(([e,t])=>({path:e,verifications:t})),s.value[e]=i,i}catch(a){throw console.error("Error fetching website stats:",a),a}},selectWebsite:e=>{a.value=e},addWebsite:async(a,s,r)=>{try{n.value=!0,l.value=null;const i=await o.createWebsite({name:a,url:s,description:r});if(i.success&&i.data)return e.value.unshift(i.data.website),"active"===i.data.website.status&&t.value.unshift(i.data.website),i.data.website}catch(i){throw console.error("Failed to add website:",i),l.value=i.message||"Failed to add website",i}finally{n.value=!1}},updateWebsite:async(t,a)=>{const s=e.value.findIndex(e=>e.id===t);if(-1!==s)return e.value[s]={...e.value[s],...a},e.value[s];throw new Error("Website not found")},deleteWebsite:async t=>{e.value=e.value.filter(e=>e.id!==t),delete s.value[t],a.value?.id===t&&(a.value=null)},totalWebsites:h,activeWebsiteCount:v,totalVerifications:w,avgHumanRate:f}});export{n as r,l as u};
